<script>
  async function loadAll() {
    const box = document.getElementById('app');
    box.textContent = '로딩 중…';
    try {
      // 프록시만 사용
      const r = await fetch('/api/schedule?mode=raw', { cache: 'no-store' });
      const data = await r.json();
      if (!data || !data.ok) throw new Error(data && data.error || 'load fail');

      window.__ALL = data.sheets;                      // 전체 저장
      fillSheetList(Object.keys(window.__ALL));        // 콤보 채우기
      render(Object.keys(window.__ALL)[0]);            // 첫 시트 렌더
    } catch (err) {
      console.error(err);
      box.textContent = '로드 실패';
    }
  }

  // ↓ 이하(escapeHtml, fillSheetList, render 등) 기존 코드 그대로
  document.getElementById('reloadBtn').onclick = loadAll;
  document.addEventListener('DOMContentLoaded', loadAll);
</script>
